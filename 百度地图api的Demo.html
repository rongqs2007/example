<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
<title>百度地图api的Demo</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<style type="text/css">  
html{height:100%}  
body{height:100%;margin:0px;padding:0px}  
#container{height:100%}  
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=4GKOZZCm6mjrjBFzrjFPoqwSMtwQcvIs">
// v3.0版本的引用方式：src="http://api.map.baidu.com/api?v=3.0&ak=您的密钥"
</script>
<!-- 点聚合js文件 -->
<script type="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>
</head>
<body>
  <div id="container"></div>
  <script>
    // 创建地图实例
    let map = new BMap.Map('container')
    // 创建坐标点
    let point = new BMap.Point(116.404, 39.915)
    // 初始化地图，设置中心点坐标和地图级别
    map.centerAndZoom(point, 15)
    // 开启鼠标滚轮缩放
    map.enableScrollWheelZoom(true)
    // 设置地图显示的城市 此项是必须设置的
    map.setCurrentCity('北京')
    // 延时2s地图平滑移动至新中心点，如果移动距离超过了当前地图区域大小，则地图会直跳到该点 map.panTo()
    // setTimeout(() => {
    //  map.panTo(new BMap.Point(116.420, 39.950))
    // }, 2000)
    // 添加地图控件
    // 控件位置偏移
    let opts = {offset: new BMap.Size(150, 25)}
    // 修改控件配置
    let optsType = {type: BMAP_NAVIGATION_CONTROL_LARGE}
    // 平移缩放控件  PC端默认位于地图左上方，它包含控制地图的平移和缩放的功能。移动端提供缩放控件，默认位于地图右下方
    map.addControl(new BMap.NavigationControl(optsType))
    // 比例尺  默认位于地图左下方，显示地图的比例关系
    map.addControl(new BMap.ScaleControl())
    // 地图类型  默认位于地图右上方
    map.addControl(new BMap.MapTypeControl({
        mapTypes: [BMAP_NORMAL_MAP, BMAP_HYBRID_MAP]
    }))
    // 版权  默认位于地图左下方
    map.addControl(new BMap.CopyrightControl())
    // 缩略地图  默认位于地图右下方，是一个可折叠的缩略地图
    map.addControl(new BMap.OverviewMapControl())
    // 定位  针对移动端开发，默认位于地图左下方
    // map.addControl(new BMap.GeolocationControl())
    
    // 向地图添加标注
    // 创建标注
    // let marker = new BMap.Marker(point)
    // map.addOverlay(marker)

    // 定义标注图标 通过Icon类可实现自定义标注的图标，下面示例通过参数MarkerOptions的icon属性进行设置，也可以使用marker.setIcon()方法。
    // 编写自定义函数，创建标注
    // 定义一个空数组接受地图标注用于点聚合使用
    let markerPoints = []
    function addMarker (point) {
      // 自定义矢量icon
      // 创建标注对象并添加到地图
      let marker = new BMap.Marker(new BMap.Point(point.lng + 0.04, point.lat - 0.03), {
        // 初始化小飞机Symbol
        icon: new BMap.Symbol(BMap_Symbol_SHAPE_POINT, {
          scale: 1,// 图标缩放大小
          fillColor: "red",// 填充颜色
          // rotation: 30,
          fillOpacity: 0.8// 填充透明度
        })
      })
      markerPoints.push(marker)
      map.addOverlay(marker)
      // 事件监听
      marker.addEventListener('click', () => {
        console.log('被点击了')
      })
      // 可拖拽标注
      marker.enableDragging()
      marker.addEventListener('dragend', (e) => {
        console.log('当前位置: ' + e.point.lng + e.point.lat)
      })
    }
    // 随机向地图添加10个标注
    let bounds = map.getBounds()
    let sw = bounds.getSouthWest()
    let ne = bounds.getNorthEast()
    let lngSpan = Math.abs(sw.lng - ne.lng)
    let latSpan = Math.abs(ne.lat - sw.lat)
    for (let i = 0; i < 10; i++) {
      let points = new BMap.Point(sw.lng + lngSpan * (Math.random() * 0.7), ne.lat - latSpan * (Math.random() * 0.7))
      addMarker(points)
    }
    console.log(markerPoints)
    // 点聚合
    let markerClusterer = new BMapLib.MarkerClusterer(map, {markers: markerPoints})
  </script>
</body>
</html>